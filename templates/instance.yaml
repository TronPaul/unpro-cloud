type: AWS::EC2::Instance
{% if depends_on %}
dependsOn: {{depends_on}}
{% endif %}
properties:
  InstanceType:
    Ref: {{instance_type}}
  KeyName:
    Ref: KeyName
{% if instance_profile %}
  IamInstanceProfile:
    Ref: {{instance_profile}}
{% endif %}
  NetworkInterfaces:
{% for ni in network_interfaces %}
    - NetworkInterfaceId:
        Ref: {{ni}}
      DeviceIndex: {{loop.index0}}
{% endfor %}
  ImageId:
    Fn::FindInMap:
      - {{image_map}}
      - Ref: AWS::Region
      - AMI
  Tags:
    - Key: Name
      Value: {{name}}
{% if roles %}
    - Key: Roles
      Value: {{roles|join(',')}}
{% endif %}
  UserData:
    Fn::Base64:
      Fn::Join:
        - ""
        -
          - '#!/bin/bash -v\n'
          - 'wget -O bootstrap-unpro.sh https://raw.githubusercontent.com/TronPaul/unpro-salt/master/bootstrap-unpro-salt\n'
          - 'sh ./bootstrap-unpro.sh -i {{name}}\n'
