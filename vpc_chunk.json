{
  "InternetGateway" : {
    "Type" : "AWS::EC2::InternetGateway",
    "Properties" : {
      "Tags" : [
        { "Key" : "Application", "Value" : { "Ref" : "AWS::StackName" } },
        { "Key" : "Network", "Value" : "Public" }
      ]
    }
  },

  "GatewayToInternet" : {
     "Type" : "AWS::EC2::VPCGatewayAttachment",
     "Properties" : {
       "VpcId" : { "Ref" : "VPC" },
       "InternetGatewayId" : { "Ref" : "InternetGateway" }
     }
  },

  "PublicRoute" : {
    "Type" : "AWS::EC2::Route",
    "DependsOn": "GatewayToInternet",
    "Properties" : {
      "RouteTableId" : { "Ref" : "PublicRouteTable" },
      "DestinationCidrBlock" : "0.0.0.0/0",
      "GatewayId" : { "Ref" : "InternetGateway" }
    }
  },

  "NATEIPAssociation" : {
    "Type" : "AWS::EC2::EIPAssociation",
    "DependsOn" : "GatewayToInternet",
    "Properties" : {
      "AllocationId" : { "Ref" : "NATEIPAllocationId" },
      "NetworkInterfaceId" : { "Ref" : "NATNetworkInterface" }
    }
  },

  "NATAllowICMP" : {
    "Type" : "AWS::EC2::SecurityGroupIngress",
    "Properties" : {
      "GroupId" : { "Ref" : "NATSecurityGroup" },
      "IpProtocol" : "icmp", 
	"FromPort" : "-1",  
	"ToPort" : "-1",  
	"SourceSecurityGroupId" : { "Ref" : "NATSecurityGroup" }
    }
  },

  "NATPublicDNSRecord" : {
    "Type" : "AWS::Route53::RecordSet",
    "DependsOn" : "NATEIPAssociation",
    "Properties" : {
      "HostedZoneName" : "teamunpro.com.",
      "Name" : "teamunpro.com",
      "Type" : "A",
      "TTL" : "60",
      "ResourceRecords" : [ {"Fn::GetAtt" : [ "NATInstance", "PublicIp" ] } ]
    }
  }
}
